[gcode_macro PURGE_FILLAMENT]
gcode:
    M117 Purge Fillament MACRO
    {% if printer.extruder.temperature < printer.configfile.config.extruder.min_extrude_temp|float %}
        RESPOND TYPE=error MSG="{ "Purge Filament Macro Error: Cold Hot End (actual temperature: " + printer.extruder.temperature|string + " < minimum temperature:" + printer.configfile.config.extruder.min_extrude_temp + ")." }"
        M117 Cold Hot End
    {% else %}
        {% if ("xyz" not in printer.toolhead.homed_axes) or (force_home_xy == 1) %}
          G28
          G90
          G0 Y250 Z5 F5000 ; Avoid  klicky
        {% endif %}
        G90
        G0 X40 Y301 Z5 F5000 #Purge bucket position
        G91
        G1 E50 F300
        G90
        CLEAN_NOZZLE
        G0 X40 Y301 Z5 F5000 #Purge bucket position
        G91
        G1 E50 F300
        G90
        CLEAN_NOZZLE
    {% endif %} 